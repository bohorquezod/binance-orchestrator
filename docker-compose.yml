services:
  binance-db-api-mcp:
    build:
      context: .
      dockerfile: Dockerfile
    image: binance-db-api-mcp:latest
    container_name: binance_db_api_mcp
    restart: unless-stopped
    environment:
      - BINANCE_DB_API_URL=${BINANCE_DB_API_URL:-http://binance-db-api:3000/api}
      - OPENAPI_SPEC_URL=${OPENAPI_SPEC_URL:-http://binance-db-api:3000/api-docs.json}
      - DB_SCHEMA_URL=${DB_SCHEMA_URL:-http://binance-db-api:3000/db/schema}
      - BINANCE_DB_API_TRANSPORT=${BINANCE_DB_API_TRANSPORT:-http}
      - BINANCE_DB_API_HTTP_HOST=${BINANCE_DB_API_HTTP_HOST:-0.0.0.0}
      - BINANCE_DB_API_HTTP_PORT=${BINANCE_DB_API_HTTP_PORT:-3000}
      - BINANCE_DB_API_HTTP_PATH=${BINANCE_DB_API_HTTP_PATH:-/}
      - BINANCE_DB_API_HTTP_HEALTH_PATH=${BINANCE_DB_API_HTTP_HEALTH_PATH:-/health}
    labels:
      - traefik.enable=true
      - traefik.docker.network=proxy
      - traefik.http.routers.binance-db-api-mcp.rule=Host(`mcp.borasta.sytes.net`) && PathPrefix(`/binance-db-api`)
      - traefik.http.routers.binance-db-api-mcp.entrypoints=mcp
      - traefik.http.routers.binance-db-api-mcp.tls=false
      - traefik.http.routers.binance-db-api-mcp.middlewares=binance-db-api-mcp-strip@docker
      - traefik.http.routers.binance-db-api-mcp.service=binance-db-api-mcp
      - traefik.http.middlewares.binance-db-api-mcp-strip.stripprefix.prefixes=/binance-db-api
      - traefik.http.services.binance-db-api-mcp.loadbalancer.server.port=3000
      - traefik.http.services.binance-db-api-mcp.loadbalancer.server.scheme=http
    healthcheck:
      test:
        [
          "CMD",
          "wget",
          "--quiet",
          "--tries=1",
          "-O",
          "/dev/null",
          "http://127.0.0.1:${BINANCE_DB_API_HTTP_PORT:-3000}${BINANCE_DB_API_HTTP_HEALTH_PATH:-/health}",
        ]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s
    networks:
      - mcp
      - proxy

networks:
  mcp:
    external: true
  proxy:
    external: true

